{"version":3,"sources":["index.js","../actions.js","frame.js"],"names":["frame"],"mappings":";;;;;;AAAC,WAAU,MAAV,EAAkB,OAAlB,EAA2B;AACxB,YAAO,OAAP,yCAAO,OAAP,OAAmB,QAAnB,IAA+B,OAAO,MAAP,KAAkB,WAAjD,GAA+D,SAA/D,GACA,OAAO,MAAP,KAAkB,UAAlB,IAAgC,OAAO,GAAvC,GAA6C,OAAO,OAAP,CAA7C,GACC,SAFD;AAGH,CAJA,aAIO,YAAY;AAAE;;AAElB,QAAI,UCNO;AACX,6BAAqB,GADV;AAEX,oBAAY,GAFD;AAGX,4BAAoB,GAHT;AAIX,8BAAsB,GAJX;AAKX,6BAAqB,GALV;AAMX,2BAAmB;AANR,KDMX;;AEJJ,QAAM,SAAS,OAAO,QAAP,CAAgB,MAA/B;AACA,QAAM,YAAY,SAAS,yCAA3B;AACA,QAAM,UAAU,SAAS,uCAAzB;AACA,QAAM,mBAAmB,CAAC,SAAS,8CAAV,CAAzB;AACA,QAAM,aAAa,UAAnB;AACA,QAAM,aAAa,SAAS,wCAA5B;AACA,QAAM,eAAe,KAArB,C;AACA,QAAM,mBAAmB,EAAzB;AACA,QAAI,KAAJ;;AAEA,QAAI,cAAc,KAAlB;AAGA,QAAI,WAAW,SAAX,QAAW,CAAS,MAAT,EAAiB,MAAjB,EAAyB;AACpC,YAAI,MAAM,SAAS,aAAT,CAAuB,QAAvB,CAAV;AACA,YAAI,IAAJ,GAAW,MAAX;AACA,YAAI,MAAJ,EAAY;AACR,mBAAO,WAAP,CAAmB,GAAnB;;AAEH,SAHD,MAGO;AACH,yBAAS,IAAT,CAAc,WAAd,CAA0B,GAA1B;AACA,yBAAS,IAAT,CAAc,WAAd,CAA0B,GAA1B;AACH;AACJ,KAVD;AAWA,QAAI,eAAe,SAAf,YAAe,CAAS,GAAT,EAAc,MAAd,EAAsB;AACrC,eAAO,YAAW;AACd,mBAAO,MAAM,GAAN,EACE,IADF,CACO;AAAA,uBAAO,IAAI,IAAJ,EAAP;AAAA,aADP,EAEE,IAFF,CAEO;AAAA,uBAAQ,SAAS,IAAT,EAAe,MAAf,CAAR;AAAA,aAFP,CAAP;AAGH,SAJD;AAKH,KAND;;AAQA,QAAI,wBAAwB,aAAa,OAAb,CAA5B;AACA,QAAI,qBAAqB,aAAa,SAAb,CAAzB;;AAEA,QAAI,kBAAkB,SAAlB,eAAkB,GAAW;AAC7B,YAAI,SAAS,SAAS,aAAT,CAAuB,UAAvB,CAAb;AACA,YAAI,CAAC,MAAL,EAAa;AACb,YAAI,SAAS,OAAO,gBAAP,EAAb;AACA,YAAI,YAAY,SAAS,aAAT,CAAuB,KAAvB,CAAhB;AACA,eAAO,WAAP,CAAmB,SAAnB;;AAEA,yBAAiB,OAAjB,CAAyB,eAAO;AAC5B,kBAAM,GAAN,EACC,IADD,CACM;AAAA,uBAAO,IAAI,IAAJ,EAAP;AAAA,aADN,EAEC,IAFD,CAEM,iBAAS;AACX,oBAAI,MAAM,SAAS,aAAT,CAAuB,OAAvB,CAAV;AACA,oBAAI,SAAJ,GAAgB,KAAhB;AACA,uBAAO,WAAP,CAAmB,GAAnB;AACH,aAND;AAOH,SARD;AASA,qBAAa,SAAb,EAAwB,MAAxB;;AAEA,iBAAS,WAAT,GAAuB,CAEtB;;AAED,iBAAS,YAAT,CAAsB,SAAtB,EAAiC,UAAjC,EAA6C;AACzC,gBAAI,QAAQ,EAAE,UAAF,EAAc;AACtB,sCADsB;AAEtB,sBAAM;AACF;AADE;AAFgB,aAAd,CAAZ;AAMA,kBAAM,KAAN,CAAY,SAAZ;AACH;AACD,eAAO,SAAP;AACH,KAhCD;;AAkCA,QAAI,eAAe,SAAf,YAAe,GAAW;AAC1B,YAAI,SAAS,SAAS,aAAT,CAAuB,UAAvB,CAAb;AACA,YAAI,UAAU,WAAW,MAAX,CAAd;AACA,YAAI,SAAS,SAAS,aAAT,CAAuB,QAAvB,CAAb;;AAEA,eAAO,KAAP,GAAe,SAAS,QAAQ,KAAjB,IAA0B,CAAzC,C;AACA,eAAO,MAAP,GAAgB,QAAQ,MAAxB;AACA,eAAO,KAAP,CAAa,MAAb,GAAsB,CAAtB;AACA,eAAO,GAAP,GAAa,aAAa,GAAb,qBACkB,QAAQ,UAD1B,sBAEY,QAAQ,KAFpB,uBAGa,QAAQ,MAHrB,oBAIU,QAAQ,GAJlB,uBAKa,QAAQ,MALrB,uBAMa,OAAO,QAAP,CAAgB,MAN7B,CAAb;AAOA,eAAO,YAAP,CAAoB,MAApB,EAA4B,WAA5B;AACA,YAAI,QAAQ,OAAR,IAAmB,IAAvB,EAA6B;AACzB,mBAAO,KAAP,CAAa,OAAb,GAAuB,MAAvB;AACA,mBAAO,KAAP,CAAa,YAAb,IAA6B,wDAA7B;AACA,wBAAY,MAAZ,EAAoB,MAApB;AACH;AACD,YAAI,QAAQ,KAAR,IAAiB,IAArB,EAA2B;AACvB,mBAAO,KAAP,CAAa,QAAb,GAAwB,OAAxB;AACA,mBAAO,KAAP,CAAa,GAAb,GAAmB,CAAnB;AACA,mBAAO,KAAP,CAAa,KAAb,GAAqB,KAArB;AACA,mBAAO,KAAP,CAAa,UAAb,GAA0B,SAA1B;AACA,mBAAO,KAAP,CAAa,YAAb,IAA6B,wDAA7B;AACH;AACD,eAAO,WAAP,CAAmB,MAAnB;AACA,eAAO,MAAP;AACH,KA9BD;;AAgCA,QAAI,aAAa,SAAb,UAAa,CAAS,MAAT,EAAiB;AAC9B,eAAO;AACH,wBAAY,OAAO,YAAP,CAAoB,aAApB,CADT;AAEH,mBAAO,OAAO,YAAP,CAAoB,OAApB,CAFJ;AAGH,oBAAQ,OAAO,YAAP,CAAoB,QAApB,CAHL;AAIH,qBAAS,OAAO,YAAP,CAAoB,SAApB,CAJN;AAKH,mBAAO,OAAO,YAAP,CAAoB,OAApB,CALJ;AAMH,iBAAK,OAAO,YAAP,CAAoB,KAApB,CANF;AAOH,oBAAQ,OAAO,YAAP,CAAoB,QAApB;AAPL,SAAP;AASH,KAVD;;AAYA,QAAI,cAAc,SAAd,WAAc,CAAS,MAAT,EAAiB,MAAjB,EAAyB;AACvC,qCAAI,SAAS,gBAAT,CAA0B,cAA1B,CAAJ,GAA+C,OAA/C,CAAuD,eAAO;AAC1D,gBAAI,KAAJ,CAAU,iBAAV,IAA+B,iBAA/B;AACA,gBAAI,KAAJ,CAAU,QAAV,IAAsB,SAAtB;AACA,gBAAI,gBAAJ,CAAqB,OAArB,EAA8B,aAAK;AAC/B,uBAAO,KAAP,CAAa,OAAb,GAAuB,OAAvB;AACA,uBAAO,KAAP,CAAa,QAAb,GAAwB,UAAxB;AACA,uBAAO,KAAP,CAAa,GAAb,GAAsB,EAAE,KAAF,GAAU,CAAhC;AACA,uBAAO,KAAP,CAAa,IAAb,GAAuB,EAAE,KAAF,GAAU,CAAjC;AACA,uBAAO,aAAP,CAAqB,WAArB,CAAiC;AAC7B,0BAAM,QAAQ,mBADe;AAE7B,2BAAO,IAAI,YAAJ,CAAiB,YAAjB;AAFsB,iBAAjC,EAGG,UAHH;AAIA,kBAAE,eAAF;AACH,aAVD;AAWH,SAdD;AAeA,iBAAS,gBAAT,CAA0B,OAA1B,EAAmC,aAAK;AACpC,gBAAI,UAAU,EAAE,MAAhB;AACA,mBAAO,QAAQ,UAAf,EAA2B;AACvB,oBAAI,YAAY,MAAhB,EAAwB;AACpB;AACH;AACD,0BAAU,QAAQ,UAAlB;AACH;AACD,mBAAO,KAAP,CAAa,OAAb,GAAuB,MAAvB;AACH,SATD;AAUH,KA1BD;;AA4BA,WAAO,gBAAP,CAAwB,SAAxB,EAAmC,UAAS,CAAT,EAAY;AAC3C,YAAI,EAAE,IAAF,CAAO,IAAP,KAAgB,MAApB,EAA4B;AACxB,0BAAc,IAAd;AACA,6BAAiB,OAAjB,CAAyB;AAAA,uBAAU,OAAO,EAAE,MAAT,CAAV;AAAA,aAAzB;AACA,6BAAiB,MAAjB,GAA0B,CAA1B;AACH;AACJ,KAND;;AAQA,QAAI,SAAS,IAAT,CAAc,gBAAd,IAAkC,YAAtC,EAAoD;;;AAGhD,6BACC,IADD,CACM,qBADN,EAEC,IAFD,CAEM,eAFN,EAGC,KAHD,CAGO;AAAA,mBAAK,QAAQ,KAAR,CAAc,CAAd,CAAL;AAAA,SAHP;AAIH,KAPD,MAOO;;AAEH,gBAAQ,cAAR;AACH;AACD,QAAA,UAAe,KAAf;;AF5JA,WAAO,gBAAP,CAAwB,SAAxB,EAAmC,UAAS,CAAT,EAAY;AAC3C,YAAI,QAAQ,EAAE,IAAd;AACAA,gBAAM,KAANA,GAAc,MAAM,IAAN,CAAW,KAAzBA;AACAA,gBAAM,MAANA,GAAe,MAAM,IAAN,CAAW,MAA1BA;AACA,YAAI,MAAM,MAAN,CAAa,OAAjB,EAA0B;AACtBA,oBAAM,UAANA,CAAiB,WAAjBA,CAA6BA,OAA7BA;AACH;AACD,YAAI,MAAM,MAAN,CAAa,KAAjB,EAAwB;AACpBA,oBAAM,KAANA,CAAY,UAAZA,GAAyB,aAAzBA;AACH;AACJ,KAVD;;;AAuLC,CA7LA,CAAD","file":"host.js","sourcesContent":["import frame from './frame'\nimport { oauth } from './oauth'\nvar Ringcentral = Ringcentral || {}\nRingcentral.widgets = {\n    oauth\n}\nwindow.addEventListener('message', function(e) {\n    var state = e.data\n    frame.width = state.size.width\n    frame.height = state.size.height\n    if (state.status.unmount) {\n        frame.parentNode.removeChild(frame)\n    }\n    if (state.status.ready) {\n        frame.style.background = 'transparent'\n    }\n})\n// Ringcentral.on()\n// Ringcentral.oauth()\n","export default {\n    HOST_DIALPAD_NUMBER: 100,\n    GUEST_INIT: 200,\n    GUEST_PHONE_RESIZE: 201,\n    GUEST_DIALPAD_NUMBER: 202,\n    GUEST_PHONE_UNMOUNT: 203,\n    GUEST_PHONE_READY: 204\n};\n","import actions from '../actions'\n\nconst DOMAIN = window.location.origin\nconst PHONE_URL = DOMAIN + '/ringcentral-js-widget/build/widgets.js'\nconst LIB_URL = DOMAIN + '/ringcentral-js-widget/build/build.js'\nconst COMMON_STYLE_URL = [DOMAIN + '/ringcentral-js-widget/build/styles/main.css']\nconst TARGET_TAG = 'rc-phone'\nconst IFRAME_URL = DOMAIN + '/ringcentral-js-widget/demo/embed.html'\nconst useShadowDOM = false /* Always fallback to iframe for now */\nconst iframeReadyQueue = []\nvar frame\n\nvar iframeReady = false\nvar drag = false\n\nvar safeEval = function(script, target) {\n    var tag = document.createElement('script')\n    tag.text = script\n    if (target) {\n        target.appendChild(tag)\n        // target.removeChild(tag)\n    } else {\n        document.body.appendChild(tag)\n        document.body.removeChild(tag)\n    }\n}\nvar fetchAndEval = function(url, target) {\n    return function() {\n        return fetch(url)\n                .then(res => res.text())\n                .then(data => safeEval(data, target))\n    }\n}\n\nvar fetchAndEvalFramework = fetchAndEval(LIB_URL)\nvar fetchAndEvalWidget = fetchAndEval(PHONE_URL)\n\nvar createContainer = function() {\n    var target = document.querySelector(TARGET_TAG)\n    if (!target) return\n    var shadow = target.createShadowRoot()\n    var container = document.createElement('div')\n    shadow.appendChild(container)\n\n    COMMON_STYLE_URL.forEach(src => {\n        fetch(src)\n        .then(res => res.text())\n        .then(style => {\n            var tag = document.createElement('style')\n            tag.innerHTML = style\n            shadow.appendChild(tag)\n        })\n    })\n    appendWidget(container, shadow)\n\n    function appendStyle() {\n\n    }\n\n    function appendWidget(container, shadowRoot) {\n        var phone = w(TARGET_TAG, {\n            shadowRoot,\n            data: {\n                shadowRoot\n            }\n        })\n        phone.mount(container)\n    }\n    return container\n}\n\nvar createIframe = function() {\n    var target = document.querySelector(TARGET_TAG)\n    var options = getOptions(target)\n    var iframe = document.createElement('iframe')\n\n    iframe.width = parseInt(options.width) + 2 // border\n    iframe.height = options.height\n    iframe.style.border = 0\n    iframe.src = IFRAME_URL + '?' +\n                    `first-level=${options.firstLevel}&` +\n                    `width=${options.width}&` +\n                    `height=${options.height}&` +\n                    `key=${options.key}&` +\n                    `secret=${options.secret}&` +\n                    `origin=${window.location.origin}`\n    iframe.setAttribute('name', 'rc-iframe')\n    if (options.dynamic != null) {\n        target.style.display = 'none'\n        iframe.style['box-shadow'] = '0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23)'\n        clickToDial(target, iframe)\n    }\n    if (options.fixed != null) {\n        target.style.position = 'fixed'\n        target.style.top = 0\n        target.style.right = '5px'\n        iframe.style.background = '#1e89ed'\n        iframe.style['box-shadow'] = '0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23)'\n    }\n    target.appendChild(iframe)\n    return iframe\n}\n\nvar getOptions = function(target) {\n    return {\n        firstLevel: target.getAttribute('first-level'),\n        width: target.getAttribute('width'),\n        height: target.getAttribute('height'),\n        dynamic: target.getAttribute('dynamic'),\n        fixed: target.getAttribute('fixed'),\n        key: target.getAttribute('key'),\n        secret: target.getAttribute('secret'),\n    }\n}\n\nvar clickToDial = function(target, iframe) {\n    [...document.querySelectorAll('[data-phone]')].forEach(ele => {\n        ele.style['text-decoration'] = 'underline black'\n        ele.style['cursor'] = 'pointer'\n        ele.addEventListener('click', e => {\n            target.style.display = 'block'\n            target.style.position = 'absolute'\n            target.style.top = `${e.pageY + 3}px`\n            target.style.left = `${e.pageX + 3}px`\n            iframe.contentWindow.postMessage({\n                type: actions.HOST_DIALPAD_NUMBER,\n                value: ele.getAttribute('data-phone')\n            }, IFRAME_URL)\n            e.stopPropagation()\n        })\n    })\n    document.addEventListener('click', e => {\n        var clicked = e.target\n        while (clicked.parentNode) {\n            if (clicked === target) {\n                return\n            }\n            clicked = clicked.parentNode\n        }\n        target.style.display = 'none'\n    })\n}\n\nwindow.addEventListener('message', function(e) {\n    if (e.data.type === 'init') {\n        iframeReady = true\n        iframeReadyQueue.forEach(action => action(e.source))\n        iframeReadyQueue.length = 0\n    }\n})\n\nif (document.body.createShadowRoot && useShadowDOM) {\n    // shadow dom is supported\n    // The order is important\n    fetchAndEvalWidget()\n    .then(fetchAndEvalFramework)\n    .then(createContainer)\n    .catch(e => console.error(e))\n} else {\n    // fallback to iframe\n    frame = createIframe()\n}\nexport default frame\n"],"sourceRoot":"/source/"}