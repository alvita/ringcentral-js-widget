{"version":3,"file":"host.js","sources":["../actions.js","frame.js","index.js"],"sourcesContent":["export default {\n    HOST_DIALPAD_NUMBER: 100,\n    GUEST_INIT: 200,\n    GUEST_PHONE_RESIZE: 201,\n    GUEST_DIALPAD_NUMBER: 202,\n    GUEST_PHONE_UNMOUNT: 203\n};\n","import actions from '../actions'\n\nconst DOMAIN = window.location.origin\nconst PHONE_URL = DOMAIN + '/ringcentral-js-widget/build/widgets.js'\nconst LIB_URL = DOMAIN + '/ringcentral-js-widget/build/build.js'\nconst COMMON_STYLE_URL = [DOMAIN + '/ringcentral-js-widget/build/styles/main.css']\nconst TARGET_TAG = 'rc-phone'\nconst IFRAME_URL = DOMAIN + '/ringcentral-js-widget/demo/embed.html'\nconst useShadowDOM = false /* Always fallback to iframe for now */\nconst iframeReadyQueue = []\nvar frame\n\nvar iframeReady = false\nvar drag = false\n\nvar safeEval = function(script, target) {\n    var tag = document.createElement('script')\n    tag.text = script\n    if (target) {\n        target.appendChild(tag)\n        // target.removeChild(tag)\n    } else {\n        document.body.appendChild(tag)\n        document.body.removeChild(tag)\n    }\n}\nvar fetchAndEval = function(url, target) {\n    return function() {\n        return fetch(url)\n                .then(res => res.text())\n                .then(data => safeEval(data, target))\n    }\n}\n\nvar fetchAndEvalFramework = fetchAndEval(LIB_URL)\nvar fetchAndEvalWidget = fetchAndEval(PHONE_URL)\n\nvar createContainer = function() {\n    var target = document.querySelector(TARGET_TAG)\n    if (!target) return\n    var shadow = target.createShadowRoot()\n    var container = document.createElement('div')\n    shadow.appendChild(container)\n\n    COMMON_STYLE_URL.forEach(src => {\n        fetch(src)\n        .then(res => res.text())\n        .then(style => {\n            var tag = document.createElement('style')\n            tag.innerHTML = style\n            shadow.appendChild(tag)\n        })\n    })\n    appendWidget(container, shadow)\n\n    function appendStyle() {\n\n    }\n\n    function appendWidget(container, shadowRoot) {\n        var phone = w(TARGET_TAG, {\n            shadowRoot,\n            data: {\n                shadowRoot\n            }\n        })\n        phone.mount(container)\n    }\n    return container\n}\n\nvar createIframe = function() {\n    var target = document.querySelector(TARGET_TAG)\n    var options = getOptions(target)\n    var iframe = document.createElement('iframe')\n\n    iframe.width = parseInt(options.width) + 2 // border\n    iframe.height = options.height\n    iframe.style.border = 0\n    iframe.src = IFRAME_URL + '?' +\n                    `first-level=${options.firstLevel}&` +\n                    `width=${options.width}&` +\n                    `height=${options.height}&` +\n                    `key=${options.key}&` +\n                    `secret=${options.secret}&` +\n                    `origin=${window.location.origin}`\n    iframe.setAttribute('name', 'rc-iframe')\n    if (options.dynamic != null) {\n        target.style.display = 'none'\n        iframe.style['box-shadow'] = '0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23)'\n        clickToDial(target, iframe)\n    }\n    if (options.fixed != null) {\n        target.style.position = 'fixed'\n        target.style.top = 0\n        target.style.right = '5px'\n        iframe.style['box-shadow'] = '0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23)'\n    }\n    target.appendChild(iframe)\n    return iframe\n}\n\nvar getOptions = function(target) {\n    return {\n        firstLevel: target.getAttribute('first-level'),\n        width: target.getAttribute('width'),\n        height: target.getAttribute('height'),\n        dynamic: target.getAttribute('dynamic'),\n        fixed: target.getAttribute('fixed'),\n        key: target.getAttribute('key'),\n        secret: target.getAttribute('secret'),\n    }\n}\n\nvar clickToDial = function(target, iframe) {\n    [...document.querySelectorAll('[data-phone]')].forEach(ele => {\n        ele.style['text-decoration'] = 'underline black'\n        ele.style['cursor'] = 'pointer'\n        ele.addEventListener('click', e => {\n            target.style.display = 'block'\n            target.style.position = 'absolute'\n            target.style.top = `${e.pageY + 3}px`\n            target.style.left = `${e.pageX + 3}px`\n            iframe.contentWindow.postMessage({\n                type: actions.HOST_DIALPAD_NUMBER,\n                value: ele.getAttribute('data-phone')\n            }, IFRAME_URL)\n            e.stopPropagation()\n        })\n    })\n    document.addEventListener('click', e => {\n        var clicked = e.target\n        while (clicked.parentNode) {\n            if (clicked === target) {\n                return\n            }\n            clicked = clicked.parentNode\n        }\n        target.style.display = 'none'\n    })\n}\n\nwindow.addEventListener('message', function(e) {\n    if (e.data.type === 'init') {\n        iframeReady = true\n        iframeReadyQueue.forEach(action => action(e.source))\n        iframeReadyQueue.length = 0\n    }\n})\n\nif (document.body.createShadowRoot && useShadowDOM) {\n    // shadow dom is supported\n    // The order is important\n    fetchAndEvalWidget()\n    .then(fetchAndEvalFramework)\n    .then(createContainer)\n    .catch(e => console.error(e))\n} else {\n    // fallback to iframe\n    frame = createIframe()\n}\nexport default frame\n","import frame from './frame'\nimport { oauth } from './oauth'\nvar Ringcentral = Ringcentral || {}\nRingcentral.widgets = {\n    oauth\n}\nwindow.addEventListener('message', function(e) {\n    var state = e.data\n    frame.width = state.size.width\n    frame.height = state.size.height\n    if (state.unmount) {\n        frame.parentNode.removeChild(frame)\n    }\n})\n// Ringcentral.on()\n// Ringcentral.oauth()\n"],"names":["frame"],"mappings":"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","sourceRoot":"/source/"}