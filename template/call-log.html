<div class="rc-panel">
    <div class='rc-panel__header'>
        <div class="rc-tabs">
            <a 
                class="rc-tabs__tab --active --color --width2" 
                data-info="allCallTab">
                All
            </a>
            <a 
                class="rc-tabs__tab --color --width2" 
                data-info="missedCallTab">
                Missed
            </a>
        </div>
    </div>
    <div class="rc-panel__content rc-call-log__content" data-info="logs">
        <call-log-item dynamic></call-log-item>
    </div>
</div>
<script>
function createWidgetItems(logItems, parent) {
    if (!logItems)
        return;
    logItems.forEach(function(item) {
        var widget = w('call-log-item', {
            actions: {
                init: {
                    method: function() {
                        return item;
                    }
                }
            }
        });
        widget.mount(parent.dom.logs);
        parent.props.widgetItems.push(widget);
    });
}

function filterWidgetItems(widgetItems, filter) {
    widgetItems.forEach(function(widget) {
        if (filter(widget)) {
            widget.show();
        }else {
            widget.hide();
        }

    });
}

function enableTab(toEnableTab, toDisableTab) {
    if (toEnableTab.classList.contains('--active') === false) {
        toEnableTab.classList.add('--active');
        toDisableTab.classList.remove('--active');
    }
}
this.actions = {
    init: {
        before: function() {
            this.props.widgetItems = [];
        },
        method: function(finish) {
            return finish();
        },
        after: function(items) {
            this.props.logItems = items;
            this.refreshCallLogs();
        }
    },
    mount: {
        after: function() {
            this.refreshCallLogs();
        }
    },
    refreshCallLogs: {
        method: function(finish) {
            return finish();
        },
        after: function() {
            // We already have widgets in view
            if (this.props.widgetItems.length > 0)
                return
            createWidgetItems(this.props.logItems, this);
        }
    },
    enableAllCallTab: {
        after: function() {
            enableTab(this.dom.allCallTab, this.dom.missedCallTab);
            filterWidgetItems(this.props.widgetItems, function() {return true;});
        }
    },
    enableMissedCallTab: {
        after: function() {
            enableTab(this.dom.missedCallTab, this.dom.allCallTab);
            filterWidgetItems(this.props.widgetItems, function(widget) {
                if (widget.props.item.result === 'Missed') {
                    return true;
                } else {
                    return false;
                }
            });
        }
    }
}
this.on('click', function(e) {
    if (e.target === this.dom.allCallTab) 
        this.enableAllCallTab()
    else if (e.target === this.dom.missedCallTab)
        this.enableMissedCallTab()
})
</script>
