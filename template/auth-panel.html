<template>
    <div class='rc-panel rc-auth-panel'>
        <div class='rc-auth-panel__container' data-info='container'>
            <div class='rc-panel__header rc-auth-panel__header rc-auth-panel__header--color'>
                <img    class='rc-img rc-auth-panel__img'
                        src='./ringcentral_logo.png'
                        data-info='logo'>
            </div>
            <div class='
                rc-panel__content 
                rc-auth-panel__content 
                rc-auth-panel__content--color'>
                <div data-info='user-info'>
                    <input 
                        class='rc-input rc-input--round' 
                        data-info='username' 
                        placeholder='username'>
                    </input>
                    <input 
                        class='rc-input rc-input--round' 
                        data-info='extension'
                        placeholder="extension"
                        ></input>
                    <input 
                        class='rc-input rc-input--round' 
                        data-info='password'
                        placeholder="password"
                        type='password'>
                    </input>
                </div>
                <div class='rc-label rc-auth-panel__error' data-info='error'></div>
                <div class='button-panel'>
                    <button 
                        class='rc-button rc-button--round rc-auth-panel__button rc-auth-panel__button--color' 
                        data-info='external-login-button'>Third party
                    </button>
                    <button 
                        class='rc-button 
                            rc-button--round 
                            rc-button--material
                            rc-auth-panel__button 
                            rc-auth-panel__button--color' 
                        data-info='login-button'>Login
                    </button>
                </div>
                <div class='rc-label' data-info='remember-wrapper'>
                    <label for='remember'>Remember me:</label>
                    <input id='remember' type='checkbox' data-info='remember' checked>
                </div>
            </div>
        </div>
        <div class='rc-auth-panel__mask display-none' data-info='disabled-mask'>
            <p data-info='disabled-mask-text'>Login...</p>
        </div>
    </div>
</template>
<script>
var fade = w.transition('fade')

this.props = {
    country: 'United States',
    username: null,
    extension: null,
    password: null,
    oauth: false
}
this.actions = {
    init: {
        before: function() {
            this.data.oauth && (this.props.oauth = this.data.oauth)
        },
        method: function(finish) {
            finish()
        },
        after: function() {
            var t = w.t(this.data.lang)
            var {color, lang, logo} = this.data
            this.dom.logo.src = logo || './ringcentral_logo.png'
            if (this.props.oauth) {
                this.dom['user-info'].classList.add('display-none')
                this.dom['remember-wrapper'].classList.add('display-none')
            }
        }
    },
    mount: {
        before: function() {},
        after: function() {
            this.dom.username.value = localStorage.getItem('username')
            this.dom.extension.value = localStorage.getItem('extension')
            this.dom.password.value = localStorage.getItem('password')

            if (this.data.external) {
                this.dom['login-button'].classList.add('display-none')
                this.dom['user-info'].classList.add('display-none')

            } else {
                this.dom['external-login-button'].classList.add('display-none')
            }

            fade.in(this.root)
        }
    },
    login: {
        before: function() {
            this.dom['login-button'].disabled = true
            this.dom.error.textContent = ''
            this.dom['disabled-mask'].classList.remove('display-none')
            this.dom['container'].classList.add('blur')
        },
        method: function(finish) {
            this.props.username = this.dom.username.value
            this.props.extension = this.dom.extension.value
            this.props.password = this.dom.password.value
            return finish()
        },
        after: function() {
            this.dom['login-button'].disabled = false
            this.dom['disabled-mask'].classList.add('display-none')
            this.dom['container'].classList.remove('blur')
            if (this.dom.remember.checked) {
                localStorage.setItem('username', this.dom.username.value || '')
                localStorage.setItem('extension', this.dom.extension.value || '')
                localStorage.setItem('password', this.dom.password.value || '')
            }
        },
        error: function(err) {
            this.dom.error.textContent = err.message || err
            this.dom['disabled-mask'].classList.add('display-none')
            this.dom['container'].classList.remove('blur')
            this.dom['login-button'].disabled = false
        }
    },
    externalLogin: {
        before: function() {
            this.dom['login-button'].disabled = true
            this.dom.error.textContent = ''
            this.dom['login-button'].classList.add('rc-button-loading')
        },
        method: function(finish) {
            return finish()
        },
        after: function() {
            // this.dom['login-button'].disabled = false
        },
        error: function(err) {
            console.error(err)
            this.dom.error.textContent = err.message
            this.dom['login-button'].disabled = false
        }
    },
    disable: {
        method: function(finish) {}
    },
    warn: {
        method: function(finish, message) {}
    },
    country: {
        method: function(finish, value) {
            if (value) {
                switchCountry.call(this, value)
                return value
            } else {
                // return this.props.country
            }
        }
    }
}
this.on('click', function(e) {
    if (e.target === this.dom['login-button']) this.login()
    if (e.target === this.dom['external-login-button']) this.externalLogin()
    if (e.target === this.dom['']) showCountry.call(this, e.target.textContent)
})
function showCountry() {
    this.dom['country-list'].classList.toggle('display-none')
}

function switchCountry(value) {
    this.dom['country-dropdown'].textContent = value
    this.dom['country-list'].classList.add('display-none')
    this.props.country = value
}
//# sourceURL=auth-panel.html
</script>
<style>
@import "src/styles/variables.css";
@import "src/styles/mixins.css";
$auth-panel-padding: 10px;
$auth-panel-flag-width: 40px;
.rc-auth-panel {
    &__content {
        display: flex;
        flex-direction: column;
        padding: $auth-panel-padding;
        .rc-input {
            margin: 5px 0;
        }
    }
    &__container {
        @mixin block;
        height: 100%;
    }
    &__header {
        text-align: center;
    }
    &__img {
        width: 60%;
    }
    &__button {
        &--color {

        }
    }
    &__mask {
        position: absolute;
        display: flex;
        flex-direction: column;
        justify-content: center;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        > p {
            font-weight: bold;
            text-align: center;
        }
        &::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
    }
    &__error {
        color: $alert-color;
        font-size: .9em;
    }

    .input-panel {
        border-radius: $border-radius;
        border: 1px solid $gray;
        &__flag {
            float: left;
            width: $auth-panel-flag-width;
            /* For test, the position is for country flag */
            height: 30px;
            background: #000;
        }
        &__phone {
            float: left;
            width: calc(100% - $auth-panel-flag-width);
        }
        > .rc-input {

        }
    }

    .button-panel {
        /* Move to the bottom of flex container */
        margin-top: auto;
        & > .rc-button {
            margin-top: 10px;
            width: 100%;
        }
    }

    .blur {
        filter: blur(2px);
        -webkit-filter: blur(2px);
    }
}

</style>
