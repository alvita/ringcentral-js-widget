<div class='rc-toolbar'>
    <div class='rc-toolbar__bar text-center' data-info='toolbar'>
        <button 
            class='rc-button rc-toolbar__menu-button' 
            data-info='menu-button'
            data-event='click:toggleMenu'>
            <span class='icon-ActionButtons_down'></span>
        </button>
    </div>
    <div class='rc-toolbar__panel' data-info='menu'>
    </div>
</div>
<script>
w.register(function() {
    var slideDown = w.transition('slide-down')
    this.props = {
        itemCount: 0
    }
    this.actions = {
        init: {
            method: function() {
                this.state = []
                this.itemCount = 0
            }
        },
        mount: {
            after: function() {
                slideDown.init(this.dom.menu)
                window.addEventListener('click', e => {
                    this.hideMenu()
                }, false)
                this.root.addEventListener('click', function(e) {
                    e.stopPropagation()
                });
            }
        },
        adjustMenuButton: {
            after: function() {
                Array.from(this.dom['toolbar'].childNodes).forEach(node => {
                    if (node.nodeType === 3)
                        node.parentNode.removeChild(node)
                })
                var mid = Math.floor((Array.from(this.dom['toolbar'].childNodes).length - 1) / 2) + 1
                var target = this.dom['toolbar'].childNodes[mid]
                target.parentNode.insertBefore(
                    this.dom['menu-button'], target
                )
            }
        },
        addItem: {
            method: function() {},
            after: function(icon, text, direction) {
                // use innerHTML here, because content could be image or something else.
                var div = document.createElement('div')
                var item
                if (this.itemCount >= 4) {
                    var template = `<div class='rc-toolbar__more-item text-center'>
                                        <button class='rc-button rc-button--circle'>
                                            ${icon}
                                        </button>
                                        <div>${text}</div>
                                    </div>`
                    
                    div.innerHTML = template
                    item = div.childNodes[0]
                    this.dom['menu'].appendChild(item)
                } else {
                    var template = `<button class='rc-toolbar__item rc-button rc-button--ghost rc-icon-switch'>
                                        ${icon}
                                    </button>`
                    div.innerHTML = template
                    item = div.childNodes[0]
                    this.dom['toolbar'].appendChild(item)
                }
                this.adjustMenuButton()
                ++ this.itemCount
                this.props.itemCount = this.itemCount
                return item
            }
        },
        clickItem: {
            method: function(finish, item, event) {
                if (typeof item === 'number') {

                } else {
                    item.addEventListener('click', () => {
                        event.call(this)
                        this.hideMenu()
                        this.state.push(event)
                    })
                }
            }
        },
        pop: {
            method: function() {
                console.log(this.state);
                if (this.state.length > 1) {
                    this.state.pop() // current state, no need to call again
                    this.state[this.state.length - 1].call(this)
                }
            }
        },
        toggleMenu: {
            after: function() {
                slideDown.toggle(this.dom.menu)
            }
        },
        hideMenu: {
            after: function() {
                slideDown.out(this.dom.menu)
            }
        },
        disableMenu: {
            after: function() {
                this.dom['menu-button'].classList.add('display-none')
            }
        },
    }
    this.on('click', 'menu-button', function(e) {
        if (this.props.itemCount > 4)
            this.toggleMenu()
    })
})
//# sourceURL=toolbar.html
</script>
<style>
@import "src/styles/variables.css";
@import "src/styles/mixins.css";
$toolbar-height: 25px;
$toolbar-more-button-raduis: 45px;
.rc-toolbar {
    @mixin block;
    @mixin shadow-1;
    z-index: 1;
    height: 100%;
    &__bar {
        @mixin block;
        @mixin shadow-1;
        height: 100%;
        z-index: 1;
        background-color: #fff;
    }
    &__menu-button {
        @mixin shadow-1;
        position: relative;
        z-index: 1;
        border: 0;
        border-left: 1px solid $gray;
        border-right: 1px solid $gray;
        border-bottom: 1px solid $gray;
        height: calc($toolbar-height + 20px);
        margin-bottom: -20px;
    }
    &__panel {
        @mixin shadow-1;
        display: flex;
        flex-wrap: wrap;
        justify-content: space-around;
        position: absolute;
        width: 100%;
        min-height: 100px;
        background-color: #fff;
    }
    &__item {}
    &__more-item {
        font-size: .6em;
        margin: 5px;
        > .rc-button {
            font-size: 1.8em;
            width: $toolbar-more-button-raduis;
            height: $toolbar-more-button-raduis;
        }
        &:hover {
            color: #333;
        }
    }
}

</style>
