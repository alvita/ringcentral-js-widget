<template>
    <div class='rc-dropdown'>
        <button class='rc-dropdown__trigger rc-button'
                data-info='dropdown'>
            <span>From: </span>
            <span data-info='dropdown-text'></span>
            <span data-info='dropdown-icon' class='icon-uni2463 rc-dropdown__icon'></span>
        </button>
        <div    class='rc-dropdown__list rc-list' 
                data-info='list'>
        </div>
    </div>
</template>
<script>
w.register(function() {
    var enlarge = w.transition('enlarge')
    this.props = {
        items: []
    }
    this.actions = {
        init: {
            after: function() {
                if (this.data.defaultValue)
                    this.switchTitle(this.data.defaultValue)
                enlarge.init(this.dom['list'])
                if (this.data.height) {
                    this.dom.dropdown.style.height = `${this.data.height}px`
                }
            }
        },
        mount: {
            after: function() {
                document.addEventListener('click', e => {
                    var currentNode = e.target
                    while(currentNode.parentNode) {
                        currentNode = currentNode.parentNode
                        if (currentNode === this.root)
                            return
                    }
                })
            }
        },
        collapse: {
            after: function() {
                enlarge.toggle(this.dom['list'])
                this.dom['dropdown-icon'].classList.toggle('icon-uni2462')
                this.dom['dropdown-icon'].classList.toggle('icon-uni2463')
            }
        },
        hide: {
            after: function() {
                enlarge.out(this.dom['list'])
                this.dom['dropdown-icon'].classList.remove('icon-uni2462')
                this.dom['dropdown-icon'].classList.add('icon-uni2463')
            }
        },
        getData: {
            method: function(finish) {
                return finish()
            },
            after: function(ids) {
                if (this.props.items && this.props.items.length)
                    return
                this.props.items = ids
                ids = ids.map(id => {
                        if(id.indexOf('+') === 0)
                            return id.substring(1)
                        return id
                    })
                    
                ids.forEach(id => this.addItem(id))
                this.switchTitle(ids[0])
            }
        },
        addItem: {
            after: function(text) {
                var item = document.createElement('div')
                // FIXME
                item.classList.add('rc-list__item', 'rc-dropdown__item')
                item.textContent = text
                item.addEventListener('click', e => {
                    this.switchTitle(text)
                })
                this.dom['list'].appendChild(item)
            }
        },
        getSelected: {
            method: function() {
                return this.dom['dropdown-text'].textContent
            }
        },
        disable: {
            method: function() {
                this.dom.dropdown.disabled = true
            }
        },
        switchTitle: {
            method: function(finish, text) {
                finish(text)
            },
            after: function(text) {
                this.dom['dropdown-text'].textContent = text
                this.hide()
            }
        }
    }
    this.on('click', 'dropdown', function() {
        this.collapse()
    })
})
//# sourceURL=dropdown.html
</script>
<style>
@import "src/styles/variables.css";
@import "src/styles/mixins.css";
$dropdown-hover-color: #ecf0f1;
.rc-dropdown {
    @mixin block;
    &__trigger {
        @mixin padding-normal;
        width: 100%;
        background: inherit;
        border: 0;
        border-bottom: 1px solid #bdc3c7;
        font-size: .8em;
    }
    &__list {
        @mixin shadow-1;
        position: absolute;
        width: 100%;
        max-height: 200px;
        overflow: auto;
        background: #fff;
    }
    &__item {
        @mixin padding-large;
        font-size: .8em;
        text-align: center;
        cursor: pointer;
        &:hover {
            background: $dropdown-hover-color;
        }
    }
    &__icon {
        margin-left: 5px;
    }
}

</style>
